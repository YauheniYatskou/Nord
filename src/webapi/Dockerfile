FROM node:fermium-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --silent --no-optional --only=production
COPY . .
ARG ENTITY_API_PORT
EXPOSE 4000

ENV PORT 4000
ARG ENTITY_API_ENV
ENV NODE_ENV ${ENTITY_API_ENV}
ARG ENTITY_API_VERSION
ENV VERSION ${ENTITY_API_VERSION}

ARG ENTITY_MONGO_USER
ENV MONGO_USER ${ENTITY_MONGO_USER}
ARG ENTITY_MONGO_PASSWORD
ENV MONGO_PASSWORD ${ENTITY_MONGO_PASSWORD}
ARG ENTITY_MONGO_SERVER
ENV MONGO_SERVER ${ENTITY_MONGO_SERVER}
ARG ENTITY_MONGO_PORT
ENV MONGO_PORT ${ENTITY_MONGO_PORT}
ARG ENTITY_MONGO_DATABASE
ENV MONGO_DATABASE ${ENTITY_MONGO_DATABASE}

CMD [ "node", "./src/app.js" ]